/*===================================================
* IDNTRAP
* LICENSE MIT 4 DECEMBER 2024
* https://github.com/Vixsry/IDNTRAP/blob/main/LICENSE
===================================================*/
class IdntAnimation{constructor(options={}){this.options={offset:options.offset||100,throttleDelay:options.throttleDelay||50,animateClass:'viks-animate',initClass:'idnt-init',startEvent:'DOMContentLoaded',disableMutationObserver:false,...options};this.elements=[];this.initialized=false;this.initialAnimation=true;document.addEventListener(this.options.startEvent,()=>{this.init();})}init(){if(this.initialized)return;document.body.classList.add(this.options.initClass);this.elements=Array.from(document.querySelectorAll('[data-idnt]'));this.hideAllElements();this.setupElements();window.addEventListener('scroll',()=>{if(this.initialAnimation){this.checkAndAnimate();this.initialAnimation=false;}else{window.requestAnimationFrame(()=>{this.checkAndAnimate();});}});window.addEventListener('resize',this.throttle(()=>{window.requestAnimationFrame(()=>{this.checkAndAnimate();});},this.options.throttleDelay));if(!this.options.disableMutationObserver&&window.MutationObserver){this.observer=new MutationObserver(mutations=>{mutations.forEach(()=>{this.refresh();});});this.observer.observe(document.body,{childList:true,subtree:true,attributes:true});}this.checkAndAnimate();this.initialized=true;}hideAllElements(){this.elements.forEach(element=>{element.style.opacity='0';});}setupElements(){this.elements.forEach(element=>{const settings=this.parseSettings(element);if(settings.duration){element.style.transitionDuration=`${settings.duration}ms`;}else{element.style.transitionDuration='1000ms';}if(settings.delay){element.style.transitionDelay=`${settings.delay}ms`;}this.setInitialState(element);});}setInitialState(element){const animation=element.getAttribute('data-idnt')||element.getAttribute('data-idnt-c')?.split(' ')[0];element.style.transform='';if(animation){if(animation.includes('fade-up')){element.style.transform='translate3d(0,50px,0)';}else if(animation.includes('fade-down')){element.style.transform='translate3d(0,-50px,0)';}else if(animation.includes('fade-left')){element.style.transform='translate3d(50px,0,0)';}else if(animation.includes('fade-right')){element.style.transform='translate3d(-50px,0,0)';}else if(animation.includes('zoom-in')){element.style.transform='scale(0.6)';}else if(animation.includes('zoom-out')){element.style.transform='scale(1.2)';}else if(animation.includes('flip')){const perspective='2500px';if(animation.includes('flip-up')){element.style.transform=`perspective(${perspective}) rotateX(-100deg)`;}else if(animation.includes('flip-down')){element.style.transform=`perspective(${perspective}) rotateX(100deg)`;}else if(animation.includes('flip-left')){element.style.transform=`perspective(${perspective}) rotateY(-100deg)`;}else if(animation.includes('flip-right')){element.style.transform=`perspective(${perspective}) rotateY(100deg)`;}}}}parseSettings(element){const settings={animation:'',duration:null,delay:null,mirror:'off',once:true};if(element.hasAttribute('data-idnt-dr')){settings.duration=parseInt(element.getAttribute('data-idnt-dr'));}if(element.hasAttribute('data-idnt-dl')){settings.delay=parseInt(element.getAttribute('data-idnt-dl'));}if(element.hasAttribute('data-idnt-mr')){settings.mirror=element.getAttribute('data-idnt-mr');}if(element.hasAttribute('data-idnt-c')){const combined=element.getAttribute('data-idnt-c').split(' ');combined.forEach(setting=>{if(setting.startsWith('dr-')){settings.duration=parseInt(setting.replace('dr-',''));}else if(setting.startsWith('dl-')){settings.delay=parseInt(setting.replace('dl-',''));}else if(setting.startsWith('mr-')){settings.mirror=setting.replace('mr-','');}else{settings.animation=setting;}});}return settings;}checkAndAnimate(){this.elements.forEach(element=>{if(this.isElementInView(element)){if(!element.classList.contains(this.options.animateClass)){this.animateElement(element);}}else if(element.dataset.idntMirror==='on'){if(element.classList.contains(this.options.animateClass)){this.hideElement(element);}}});}isElementInView(element){const rect=element.getBoundingClientRect();const windowHeight=window.innerHeight;const offset=this.options.offset;const trigger=rect.top+offset;return trigger<=windowHeight&&rect.bottom>=0;}animateElement(element){requestAnimationFrame(()=>{element.classList.add(this.options.animateClass);element.style.opacity='1';element.style.transform='none';element.style.transition=`transform 1s,opacity 1s ${element.style.transitionDelay}`;});}hideElement(element){requestAnimationFrame(()=>{element.classList.remove(this.options.animateClass);element.style.opacity='0';this.setInitialState(element);});}throttle(func,limit){let inThrottle;return function(){const args=arguments;const context=this;if(!inThrottle){func.apply(context,args);inThrottle=true;setTimeout(()=>inThrottle=false,limit);}};}refresh(){this.elements=Array.from(document.querySelectorAll('[data-idnt]'));this.setupElements();this.checkAndAnimate();}reset(){this.elements.forEach(element=>{element.classList.remove(this.options.animateClass);this.setInitialState(element);});this.hideAllElements();this.initialAnimation=true;this.checkAndAnimate();}}